[
["options.html", "Capítulo 6 Opciones, Derivados y Futuros 6.1 Call &amp; Put 6.2 Estrategias 6.3 Black &amp; Scholes 6.4 Black &amp; Scholes con Datos Reales 6.5 Árbol Binomial", " Capítulo 6 Opciones, Derivados y Futuros IMPORTANTE: Aún no está del todo listo el formato en pdf, por lo que recomiendo verlo online. if(!require(&quot;pacman&quot;)) install.packages(&quot;pacman&quot;) ## Loading required package: pacman p_load(&quot;tidyverse&quot;,&quot;quantmod&quot;) 6.1 Call &amp; Put A modo de resumen, existen cuatro tipos de posiciones en las opciones: Posición larga en una opción de compra (call) Posición larga en una opción de venta (put) Posición corta en una opción de compra (call) Posición corta en una opción de venta (put) Simulamos nuestro \\(S_t\\): # Valores para el ejemplo s &lt;- seq(0,130,by=10) # Precio Para la call usamos: v (precio de la call) = $5, precio de ejercicio (k) = 100. Para la put usamos: v (precio de la put) = $7, precio de ejercicio (k) = 70. 6.1.1 Posición Larga en Call: Payoff &amp; Profit EL rendimiento proveniente de una opción larga en una opción de compra europea es: Payoff opción call larga \\[ \\text{payoff} = \\text{max}(S_t - k,0) \\] Profit opción call larga \\[ \\text{profit} = \\text{payoff} - v*e^{-r*t} \\] Construimos la función: long.callpayoff &lt;- function(s,k,v,r,t){ data.frame(&quot;payoff&quot; = pmax(0,s-k), &quot;periodo&quot; = s) %&gt;% mutate(&quot;profit&quot; = payoff - v*exp(-r*t)) } payoff.longcall &lt;- long.callpayoff(s,100,5,0,0) Gráfico posición larga en call: g1 &lt;- ggplot(payoff.longcall) + geom_line(aes(x = periodo, y = payoff), colour=&quot;red&quot;, size=1.5) + xlab(&quot;Tiempo de Expiracion&quot;) + ylab(&quot;Payoff&quot;) g1 &lt;- g1 + theme_bw() + ggtitle(&quot;Payoff de una Option Call&quot;) g1 &lt;- g1 + labs(subtitle = &quot;Posicion Larga en Call&quot;) g1 &lt;- g1 + scale_x_continuous(limits=c(70, 130)) + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank()) g1 Para corroborar el gráfico ver la figura 9.1 (capítulo 9) del libro Introducción a los Mercados de Futuros y Opciones (octava edición). Para efecto de académicos restringimos la escala del eje x e y (dimensión). Gráfico profit posición larga en call: g2 &lt;- ggplot(payoff.longcall) + geom_line(aes(x = periodo, y = profit), colour=&quot;red&quot;, size=1.5) + xlab(&quot;Tiempo de Expiracion&quot;) + ylab(&quot;Profit&quot;) g2 &lt;- g2 + theme_bw() + ggtitle(&quot;Profit de una Option Call&quot;) + labs(subtitle = &quot;Posicion Larga en Call&quot;) g2 &lt;- g2 + geom_hline(yintercept=0, linetype=&quot;dashed&quot;,color = &quot;blue&quot;, size=1.5) g2 &lt;- g2 + scale_x_continuous(breaks = round(seq(min(payoff.longcall$periodo), max(payoff.longcall$periodo), by = 10),1),limits=c(70, 130)) + scale_y_continuous(breaks = round(seq(min(payoff.longcall$profit), max(payoff.longcall$profit), by = 10),1),limits = c(limits=c(-5, 30))) g2 &lt;- g2 + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank()) g2 6.1.2 Posición larga en put: Payoff &amp; Profit EL rendimiento para el tenedor de una opción larga en una opción de venta europea: Payoff opción put larga: \\[ \\text{payoff} = \\text{max}(k - S_t,0) \\] Profit opción put larga: \\[ \\text{profit} = \\text{payoff} - v*e^{-r*t} \\] Construimos la función: long.putpayoff &lt;- function(s,k,v,r,t){ data.frame(&quot;payoff&quot; = pmax(k-s,0), &quot;periodo&quot; = s) %&gt;% mutate(&quot;profit&quot; = payoff - v*exp(-r*t)) } payoff.longput &lt;- long.putpayoff(s,70,7,0,0) Gráfico posición larga en put g3 &lt;- ggplot(payoff.longput) + geom_line(aes(x = periodo, y = payoff), colour=&quot;red&quot;, size=1.5) + xlab(&quot;Tiempo de Expiracion&quot;) + ylab(&quot;Payoff&quot;) g3 &lt;- g3 + theme_bw() + ggtitle(&quot;Payoff de una Option Put&quot;) + labs(subtitle = &quot;Posicion Larga en Put&quot;) g3 &lt;- g3 + scale_x_continuous(limits=c(40, 100)) + scale_y_continuous(limits=c(0, 30)) + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank()) g3 Para corroborar el gráfico ver la figura 9.2 (capítulo 9) del libro Introducción a los Mercados de Futuros y Opciones (octava edición). Para efecto de académicos restringimos la escala del eje x e y (dimensión). Gráfico posición larga en put: g4 &lt;- ggplot(payoff.longput) + geom_line(aes(x = periodo, y = profit), colour=&quot;red&quot;, size=1.5) + xlab(&quot;Tiempo de Expiracion&quot;) + ylab(&quot;Profit&quot;) g4 &lt;- g4 + theme_bw() + ggtitle(&quot;Profit de una Option Put&quot;) + labs(subtitle = &quot;Posicion Larga en Put&quot;) g4 &lt;- g4 + geom_hline(yintercept=0, linetype=&quot;dashed&quot;,color = &quot;blue&quot;, size=1.5) g4 &lt;- g4 + scale_x_continuous(breaks = round(seq(min(payoff.longput$periodo), max(payoff.longput$periodo), by = 10),1),limits=c(40, 100)) + scale_y_continuous(breaks = round(seq(min(payoff.longput$profit), max(payoff.longput$profit), by = 10),1),limits = c(limits=c(-7, 30))) g4 &lt;- g4 + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank()) g4 6.1.3 Posición corta en call: Payoff &amp; Profit EL rendimiento para el tenedor de una posición corta en una opción de compra europea es: Payoff opción call corta: \\[ \\text{payoff} = -\\text{max}(S_t - k,0) = \\text{min}(k - S_t,0) \\] Profit opción call corta: \\[ \\text{profit} = \\text{payoff} + v*e^{-r*t} \\] Construimos la función: short.callpayoff &lt;- function(s,k,v,r,t){ data.frame(&quot;payoff&quot; = pmin(k-s,0),&quot;periodo&quot; = s) %&gt;% mutate(&quot;profit&quot; = payoff + v*exp(-r*t)) } payoff.shortcall &lt;- short.callpayoff(s,100,5,0,0) Gráfico posición corta en call g5 &lt;- ggplot(payoff.shortcall) + geom_line(aes(x = periodo, y = payoff), colour=&quot;red&quot;, size=1.5) + xlab(&quot;Tiempo de Expiracion&quot;) + ylab(&quot;Payoff&quot;) g5 &lt;- g5 + theme_bw()+ ggtitle(&quot;Payoff de una Option Call&quot;) + labs(subtitle = &quot;Posicion Corta en Call&quot;) g5 &lt;- g5 + scale_x_continuous(limits=c(70, 130)) + scale_y_continuous(limits=c(-30, 0)) + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank()) g5 Para corroborar el gráfico ver la figura 9.3 (capítulo 9) del libro Introducción a los Mercados de Futuros y Opciones (octava edición). Para efecto de académicos restringimos la escala del eje x e y (dimensión). Gráfico posición corta en call: g6 &lt;- ggplot(payoff.shortcall) + geom_line(aes(x = periodo, y = profit), colour=&quot;red&quot;, size=1.5) + xlab(&quot;Tiempo de Expiracion&quot;) + ylab(&quot;Profit&quot;) g6 &lt;- g6 + theme_bw() + ggtitle(&quot;Profit de una Option Call&quot;) + labs(subtitle = &quot;Posicion Corta en Call&quot;) g6 &lt;- g6 + geom_hline(yintercept=0, linetype=&quot;dashed&quot;,color = &quot;blue&quot;, size=1.5) g6 &lt;- g6 + scale_x_continuous(breaks = round(seq(min(payoff.shortcall$periodo), max(payoff.shortcall$periodo), by = 10),1),limits=c(70, 130)) + scale_y_continuous(breaks = round(seq(min(payoff.shortcall$profit), max(payoff.shortcall$profit), by = 10),1),limits = c(limits=c(-30, 5))) g6 &lt;- g6 + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank()) g6 6.1.4 Posición corta en put: Payoff &amp; Profit EL rendimiento para el tenedor de una posición corta en una opción de venta europea es: Payoff opción put corta: \\[ \\text{payoff} = -\\text{max}(k - S_t,0) = \\text{min}(S_t - k,0) \\] Profit opción put corta: \\[ \\text{profit} = \\text{payoff} + v*e^{-r*t} \\] Construimos la función: short.putpayoff &lt;- function(s,k,v,r,t){ data.frame(&quot;payoff&quot; = pmin(s-k,0),&quot;periodo&quot; = s) %&gt;% mutate(&quot;profit&quot; = payoff + v*exp(-r*t)) } payoff.shortput &lt;- short.putpayoff(s,70,7,0,0) Gráfico posición corta en call: g7 &lt;- ggplot(payoff.shortput) + geom_line(aes(x = periodo, y = payoff), colour=&quot;red&quot;, size=1.5) + xlab(&quot;Tiempo de Expiracion&quot;) + ylab(&quot;Payoff&quot;) g7 &lt;- g7 + theme_bw() + ggtitle(&quot;Payoff de una Option Put&quot;) + labs(subtitle = &quot;Posicion Corta en Put&quot;) g7 &lt;- g7 + scale_x_continuous(limits=c(40, 100)) + scale_y_continuous(limits=c(-30, 0)) + theme(panel.grid.major = element_blank(),panel.grid.minor = element_blank()) g7 Para corroborar el gráfico ver la figura 9.4 (capítulo 9) del libro Introducción a los Mercados de Futuros y Opciones (octava edición). Para efecto de académicos restringimos la escala del eje x e y (dimensión). g8 &lt;- ggplot(payoff.shortput) + geom_line(aes(x = periodo, y = profit), colour=&quot;red&quot;, size=1.5) + xlab(&quot;Tiempo de Expiracion&quot;) + ylab(&quot;Profit&quot;) g8 &lt;- g8 + theme_bw() + ggtitle(&quot;Profit de una Option Put&quot;) + labs(subtitle = &quot;Posicion Corta en Put&quot;) g8 &lt;- g8 + geom_hline(yintercept=0, linetype=&quot;dashed&quot;,color = &quot;blue&quot;, size=1.5) g8 &lt;- g8 + scale_x_continuous(breaks = round(seq(min(payoff.shortput$periodo), max(payoff.shortput$periodo), by = 10),1),limits=c(40, 100)) + scale_y_continuous(breaks = round(seq(min(payoff.shortput$profit), max(payoff.shortput$profit), by = 10),1),limits = c(limits=c(-30, 7))) g8 &lt;- g8 + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank()) g8 6.2 Estrategias Una estrategia de negociación de diferenciales implica tomar una posición en dos o más opciones del mismo tipo (dos o más opciones de compra o dos o más opciones de venta). Las más conocidas son: Diferenciales Alcistas (bull spreads) Diferenciales bajistas (bear spreads) Estrategias con opciones de tipo mariposa (butterfly spread) Diferenciales Alcistas (bull spreads): Este se crea mediante la adquisición de una opción de compra europea sobre una acción, con cierto precio de ejercicio, y la venta de una opción de compra europea sobre la misma acción con un precio de ejercicio más alto. Ambas opciones tienen la misma fecha de expiración. 6.2.1 Bull Spread Utilidades Intervalo variación precio acción Beneficio derivado de call larga Beneficio derivado de call corta Beneficio total \\(S_t \\leq K_1\\) 0 0 0 \\(K_1 &lt; S_t &lt; K_2\\) \\(S_t - K_1\\) 0 \\(S_t - K_1\\) \\(S_t \\geq K_2\\) \\(S_t - K_1\\) \\(K_2 - S_t\\) \\(K_2 - K_1\\) Ejemplo Bull Spread: Un inversionista adquiere en 3 una opción de compra a tres meses con un precio de ejercicio de 30, y vende en 1 un opción de compra a tres meses con un precio de ejercicio de 35. El beneficio derivado de esta estrategia de diferencial alcista es de 5 si el precio de la acción está por arriba de 35, y de cero si está por debajo de 30. Si el precio de la acción se encuentra entre 30 y 35, el beneficio es la cantidad en la cual el precio de ejercicio excede de 30. El costo de la estrategia es 3 - 1 = 2. Por lo tanto, la utilidad es: Intervalo variación precio acción Utilidad \\(S_t \\leq 30\\) -2 \\(30 &lt; S_t &lt; 35\\) \\(S_t - 32\\) \\(S_t \\geq 35\\) +3 6.2.2 Función Bull Spread Comenzamos contruyendo la estructura de la estrategia: bullspread.call &lt;- function(S,K1,K2,precio1,precio2){ if(K1&gt;=S) stop(&quot;K1 debe ser menor a S.&quot;) if(S&gt;=K2) stop(&quot;K2 debe ser mayor a S.&quot;) #larga callP1 = precio1 #corto callP2 = precio2 stock=unique(round(seq(0,K1,length.out=6))) stock=c(stock,round(seq(K1,K2,length.out=4))) stock=c(stock,round(seq(K2,K2+K1,length.out=6))) stock=unique(stock) payoff=rep(0,length(stock)) profit=rep(0,length(stock)) for(i in 1:length(stock)){ if(stock[i]&lt;=K1) payoff[i]=0 if(stock[i]&gt;=K2) payoff[i]=K2-K1 if(stock[i]&lt;K2 &amp; stock[i]&gt;K1) payoff[i]=stock[i]-K1 profit[i]=payoff[i]+(callP2-callP1) } data &lt;- data.frame(stock,payoff,profit) return(data) } 6.2.3 Posición call Larga &amp; Corta Para el Bull Spread Call Para ilustrar calculamos las dos call (larga y corta): Es la misma función vista anteriormente, solo que en vez de tener una columna llamada “periodo” ahora será “stock”, conceptualmente es lo mismo, pero facilita para graficar: # Posición larga en call long.callpayoff &lt;- function(s,k,v,r,t){ data.frame(&quot;payoff&quot; = pmax(0,s-k), &quot;stock&quot; = s) %&gt;% mutate(&quot;profit&quot; = payoff - v*exp(-r*t)) } # Posición corta en call short.callpayoff &lt;- function(s,k,v,r,t){ data.frame(&quot;payoff&quot; = pmin(k-s,0),&quot;stock&quot; = s) %&gt;% mutate(&quot;profit&quot; = payoff + v*exp(-r*t)) } 6.2.4 Construcción de la Bull Spread Call En el Global Environment vemos el objeto `bull.spread``, que tiene los stock (\\(S_t\\)), payoff y profit. bull.spread &lt;- bullspread.call(32,30,35,3,1) # Extraemos la St s &lt;- bull.spread$stock # Call larga long.call &lt;- long.callpayoff(s,30,3,0,0) # Call corta short.call &lt;- short.callpayoff(s,35,1,0,0) 6.2.5 Gráfico Bull Spread Call g1 &lt;- ggplot(bull.spread[4:10,]) + geom_line(aes(long.call$stock[4:10],long.call$profit[4:10],color = &quot;blue&quot;),linetype=&quot;dashed&quot; ,size=1) g1 &lt;- g1 + geom_line(aes(short.call$stock[4:10],short.call$profit[4:10], color = &quot;red&quot;),linetype=&quot;dashed&quot;,size=1) g1 &lt;- g1 + geom_line(aes(bull.spread$stock[4:10],bull.spread$profit[4:10],color = &quot;green&quot;),size=1) g1 &lt;- g1 + ggtitle(&quot;Estrategia Bull Spreads&quot;) + xlab(&quot;stock&quot;) + ylab(&quot;Profit&quot;) + theme_bw() g1 &lt;- g1 + geom_hline(yintercept=0, linetype=&quot;dashed&quot;,color = &quot;orange&quot;, size=1) g1 &lt;- g1 + scale_color_manual(name = &quot; &quot;,labels = c(&quot;Call larga&quot;, &quot;Bull Spread&quot;, &quot;Call corta&quot;),values = c(&quot;blue&quot;=&quot;blue&quot;,&quot;green&quot;=&quot;green&quot;,&quot;red&quot; = &quot;red&quot;)) g1 &lt;- g1 + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),legend.position=&quot;bottom&quot;) g1 6.2.6 Con librería la Bull Spread Call Una librería útil para construir estratégias es la librería FinancialMath, recuerden install.packages(&quot;FinancialMath&quot;) y luego library(&quot;FinancialMath&quot;): # Con librería # bull.call(S,K1,K2,r,t,price1,price2,plot=FALSE) library(&quot;FinancialMath&quot;) bull.call &lt;- bull.call(31,30,35,0.0000001,3,3,1,plot=TRUE) Otras funciones son, bear.call(),straddle(),strangle(),butterfly.spread(). NB: Es importante que el \\(S_t\\) debe estar entre \\(k_1\\) y \\(k_2\\). Deben incluir una tasa de interés y un T, pero si no se especifica, agreguen una cerca a cero. 6.2.7 Con librería El gráfico Bull Spread Call 6.2.8 Payoff inferior Bull Spread Call de la Librería Los payoff inferiores deberían ser igual a -2: head(bull.call$Payoff,4) Table 6.1: Bull Spread Call Stock Price Payoff Profit 0 0 -2.000001 6 0 -2.000001 12 0 -2.000001 18 0 -2.000001 6.2.9 Payoff superior Bull Spread Call de la Librería Los payoff inferiores deberían ser igual a 3: tail(bull.call$Payoff,4) Table 6.2: Bull Spread Call Stock Price Payoff Profit 11 47 5 2.999999 12 53 5 2.999999 13 59 5 2.999999 14 65 5 2.999999 6.3 Black &amp; Scholes 6.3.1 Black &amp; Scholes: de la formula a una función Las Formulas de Black Scholes y Merton para los precios de las opciones de compra y de venta europeas sobre acciones que no pagan dividendos son: Formulas de Valuación Black,Scholes &amp; Merton \\(c = S_0 N(d_1) - K e^{-rt} N(d_2)\\) \\(p = K e^{-rt} N(-d_2) - S_0 N(-d_1)\\) donde: \\(d_1 = \\frac{ln(S_0/K) + (r + \\sigma^2 / 2)T}{\\sigma \\sqrt{T}}\\) \\ \\(d_2 = \\frac{ln(S_0/K) + (r - \\sigma^2 / 2)T}{\\sigma \\sqrt{T}} = d_1 - \\sigma \\sqrt{T}\\) 6.3.2 Black &amp; Scholes: Ejercicio Uso de la formula en R: El precio de las acciones después de seis meses a partir de la expiración de una opción es de 42, el precio de ejercicio de la opción es de 40, la tasa de interés libre de riesgo es de 10% anual y la volatilidad es de 20% anual. Esto Significa: # Parámetros S0 &lt;- 42 K &lt;- 40 r &lt;- 0.1 T &lt;- 1/2 sigma &lt;- 0.2 6.3.3 Black &amp; Scholes: Función Construimos la función basándonos en la formula: bs.opm &lt;- function(S,K,T,riskfree,sigma,type){ d1&lt;-(log(S/K)+(riskfree+0.5 * sigma^2) * T)/(sigma * sqrt(T)) d2&lt;-d1-sigma * sqrt(T) if(type==&quot;Call&quot;){ opt.val&lt;-S * pnorm(d1)-K * exp(-riskfree * T) * pnorm(d2) } if(type==&quot;Put&quot;){ opt.val&lt;-K * exp(-riskfree * T) * pnorm(-d2)-S * pnorm(-d1) } opt.val } # Para la call C &lt;- bs.opm(S = S0, K = K, T = T, riskfree = r, sigma = sigma, type = &quot;Call&quot; ) C ## [1] 4.759422 # Para la put C &lt;- bs.opm(S = S0, K = K, T = T, riskfree = r, sigma = sigma, type = &quot;Put&quot; ) C ## [1] 0.8085994 6.3.4 Black &amp; Scholes: Ahora con librerías La librería que se utilizará para usa BS es fOptions, recordar el install.packages(&quot;fOptions&quot;) y posterior library(&quot;fOptions&quot;). library(&quot;fOptions&quot;) La función de la librería es GBSOption(): GBSOption(TypeFlag = &quot; &quot;, S = S0, X = K, Time = T, r = r, b = r, sigma = sigma) En TypeFlag, va “c” para call y “p” para put, tener presente que deberán seleccionar un b que es el annualized cost-of-carry rate, si no se especifica, debe ser igual a r. # Con libreria call GBSOption(TypeFlag = &quot;c&quot;, S = S0, X = K, Time = T, r = r, b = r, sigma = sigma)@price ## [1] 4.759423 # Con libreria put GBSOption(TypeFlag = &quot;p&quot;, S = S0, X = K, Time = T, r = r, b = r, sigma = sigma)@price ## [1] 0.8086 6.4 Black &amp; Scholes con Datos Reales 6.4.1 Black &amp; Scholes con Datos Reales: Pasos Una manera de trabajar con datos reales directo usando R, es: Usar las funcion getOptionChain de la librería quantmod. Seleccionar las call y put para la fecha de valuación (recomiendo en objetos separados). Usar la función getSymbols de la librería quantmod para elegir el ticker correspondiente, calcular el retorno y extraer el precio a la fecha que se está haciendo la valuación. “Construimos”&quot; la fecha de expiración y valuación, esto nos permite calcular el \\(T\\) a través de: \\(\\frac{\\text{expiración - valuación}}{365}\\). La tasa libre de riesgo se puede obtener de FRED usando la 3-Month Constant Maturity Treasury yield (debe ser la fecha de valuación, un único valor). Para la volatilidad se puede usar la desviación estándar de los últimos 3 años multiplicado por 252, esto se hace para anualizarlo. Finalmente seleccionamos las que están cerca al at the money y usamos Black &amp; Scholes, por librería o bien la función que creamos. 6.4.2 Parte a Imaginemos que es 31 de mayo del 2018 y queremos valorar las opciones call y put de Oracle con vencimiento al 17 de Agosto del 2018. Para comenzar usamos la función getOptionChain() de la librería quantmod: opciones &lt;- getOptionChain(&quot;ORCL&quot;,Exp=&quot;2018-12-21&quot;) calls &lt;- opciones$calls[,c(1:2,4:6)] # Nos quedamos con las columnas del 1 al 2 y del 4 al 6. puts &lt;- opciones$puts[,c(1:2,4:6)] # Nos quedamos con las columnas del 1 al 2 y del 4 al 6. 6.4.3 Parte b Como debemos obtener el precio de cierre para el 31 de mayo del 2018 y a su vez el histórico de tres años para la volatilidad usamos: # Al 31 de mayo la valuación, 31 de mayo del 2015 fue domingo, por ende, usamos el viernes 29 getSymbols(&quot;ORCL&quot;, from = &quot;2015-05-29&quot;, to = &quot;2018-06-01&quot;, periodicity = &quot;daily&quot;) ## [1] &quot;ORCL&quot; orcl &lt;- as.data.frame(ORCL) %&gt;% # a data.frame mutate(ret = log(ORCL.Adjusted/lag(ORCL.Adjusted))) %&gt;% # construimos el retorno select(ORCL.Adjusted,ret) %&gt;% # Seleccionamos el retorno y precio de ajuste na.omit() # por el NA que se produce del retorno # extraemos el precio a la fecha que nos piden precio &lt;- tail(orcl$ORCL.Adjusted,1) 6.4.4 Parte c y d Con la función getSymbols usamos la fuente de la FRED y extraemos la rf con subset. getSymbols(&quot;DGS3MO&quot;,src =&quot;FRED&quot;, to = &quot;2018-06-01&quot;, periodicity = &quot;daily&quot;) ## [1] &quot;DGS3MO&quot; rf &lt;- as.numeric(subset(DGS3MO[&quot;2018-05-31&quot;]))*0.01 expiracion.date &lt;- as.Date(&quot;2018-08-17&quot;) valuacion.date &lt;- as.Date(&quot;2018-06-01&quot;) TTM &lt;- as.numeric((expiracion.date-valuacion.date)/365) Extraemos del objeto orcl y calculamos su desviación estándar, luego se multiplica por 252. vol.hist &lt;- sd(orcl$ret)*sqrt(252) 6.4.5 Parte e Vemos el precio a la fecha la valuación y seleccionamos aquellas cercana a estar at the money, tanto put como call. bs.call &lt;- calls %&gt;% dplyr::filter(Strike == 45 | Strike == 50) %&gt;% select(Strike,Last,Bid,Ask) bs.put &lt;- puts %&gt;% dplyr::filter(Strike == 45 | Strike == 50) %&gt;% select(Strike,Last,Bid,Ask) # call GBSOption(TypeFlag = &quot;c&quot;, S = precio, X = 45, Time = TTM, r = rf, b = rf, sigma = vol.hist)@price ## [1] 1.720309 GBSOption(TypeFlag = &quot;c&quot;, S = precio, X = 50, Time = TTM, r = rf, b = rf, sigma = vol.hist)@price ## [1] 0 # put GBSOption(TypeFlag = &quot;p&quot;, S = precio, X = 45, Time = TTM, r = rf, b = rf, sigma = vol.hist)@price ## [1] 0 GBSOption(TypeFlag = &quot;p&quot;, S = precio, X = 50, Time = TTM, r = rf, b = rf, sigma = vol.hist)@price ## [1] 3.259375 6.5 Árbol Binomial Generalización Una generalización cuando queremos realizar un árbol con dos pasos: \\(p = \\frac{e^{r \\Delta t} - d}{u - d}\\) \\(f_u = e^{-r \\Delta t} [pf_{uu} + (1-p) f_{ud}]\\) \\(f_d = e^{-r \\Delta t} [pf_{ud} + (1-p) f_{dd}]\\) \\(f = e^{-r \\Delta t} [pf_{u} + (1-p) f_{d}] = e^{-2r \\Delta t} [p^2 f_{uu} + 2p(1-p) f_{ud} + (1-p)^2 f_{dd}]\\) esto último solo cuando es una opción europea. No obstante, en términos del modelo, \\(u = e^{\\sigma \\sqrt{\\Delta t}}\\) y \\(d = e^{-\\sigma \\sqrt{\\Delta t}} = \\frac{1}{u}\\). 6.5.1 Ejercicio Considere una call europea a dos años con precio de strike de 52 en una acción cuyo precio es 50. Suponga que existen two time steps en un año, y en cada time steps el precio se mueve 30%. La tasa de interes libre de riesgo es 5%. La librería a usar será de nuevo fOptions. library(&quot;fOptions&quot;) 6.5.2 Call europea # Europea CRRTree = BinomialTreeOption(TypeFlag = &quot;ce&quot;, S = 50, X = 52, Time = 2, r = 0.05, b = 0.05, sigma = 0.3, n = 2) CRRTree BinomialTreePlot(CRRTree, dy = 1, cex = 0.8, ylim = c(-6, 7), xlab = &quot;n&quot;, ylab = &quot;valores Opción&quot;) title(main = &quot;Arbol Binomial Opción&quot;) 6.5.3 Call europea gráfico 6.5.4 Call americana # Americana CRRTree.1 = BinomialTreeOption(TypeFlag = &quot;ca&quot;, S = 50, X = 52, Time = 2, r = 0.05, b = 0.05, sigma = 0.3, n = 2) CRRTree.1 BinomialTreePlot(CRRTree.1, dy = 1, cex = 0.8, ylim = c(-6, 7), xlab = &quot;n&quot;, ylab = &quot;valores Opción&quot;) title(main = &quot;Arbol Binomial Opción&quot;) 6.5.5 Call americana gráfico "]
]
